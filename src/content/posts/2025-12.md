---
date: 2025-12
author: return null;
tags:
  - Java
  - 排查
  - 性能优化
cover: null
---

# 2025-12 高并发时应用宕机问题排查

## 一、问题现象

:::timeline
- **2025-12-16 21:39:00** CI/CD 平台告警，应用负载实例存活比率低于 35%
- **2025-12-16 21:42:00** 观察应用监控，发现流量远超日常（QPS≈49,000）
- **2025-12-16 21:45:00** 尝试重启 & 重新部署挂掉的机器（但一直无法重启/操作成功）
:::

``` dockerfile
# JDK 21 & 机器配置 2C4G x 28（单台需承受 1,750 QPS）
ENTRYPOINT ["java", \
    "-Duser.timezone=GMT+08", \
    "-XX:+UseZGC", \
    "-Xms2867m", \
    "-Xmx2867m", \
    "-XX:+PrintCommandLineFlags", \
    "-XX:+HeapDumpOnOutOfMemoryError", \
    "-XX:HeapDumpPath=java_pid%p.hprof", \
    "-XX:+UseContainerSupport", \
    "-Xlog:gc*:file=gc.log:time,level,tags:filecount=10,filesize=100M", \
    "-jar", \
    "app.jar"]
```

## 二、止损手段

:::timeline
- **2025-12-16 21:52:55** 临时通知运维尝试扩容 +12（此时单台承受 1,225 QPS，按后续压测情况看，此时单台只能承受 200 QPS，扩容数量完全不够）
- **2025-12-16 22:05:30** 流量自然下降，CPU 使用率随之下降，接口耗时回归正常
:::

## 三、排查过程

**2025-12-17**一开始目光全在某个三方接口上，一直以为是内存问题，因为有大量 GC 后宕机。之后发现另一个三方接口报文也很大且非核心接口，故开始压测该接口。

    在不变更机器配置（2C4G）的情况下，通过切换 JDK 21 -> 1.8，GC ZGC -> G1 -> CMS 发现效果均不好

**2025-12-25** 通过应用监控大盘发现大量守护线程，排查代码初步怀疑 OkHttpClient 使用不规范导致。

## 四、优化手段

- 该项目早前已升级至 JDK 21 故可开启`虚拟线程`优化性能